<!DOCTYPE html>
<html>
	<head>
		<title>SoliTime</title>
	</head>
	<body>
	<h1>Configure SoliTime</h1>

		<table style="width: 100%;">
			<tr>
				<td colspan="2"><h3><b>Visual Settings</h3></b></td>
			</tr>
			<tr>
				<td>Bold hour</td>
				<td>
				    <select id="boldhour_select"  style="display: block; width: 100%;">
						<option value="off">Off</option>
						<option value="on">On</option>
					</select>		
				</td>
			</tr>
			<tr>
				<td colspan="2"><h3><b>Color settings (Pebble Time only)</h3></b></td>
			</tr>
			<tr>
				<td>Background color</td>
				<td>
				      <!--<input id="bgcolor_select" style="display: block; width: 100%;" class="form-control" onchange="clickColor(0, -1, -1, 5)" value="#ff0000" type="color">-->
				
				    <select id="bgcolor_select"  style="display: block; width: 100%;">
						<option value="gray">Gray</option>
						<option value="blue ">Blue</option>
						<option value="green">Green</option>
						<option value="red">Red</option>
					</select>		
				</td>
			</tr>
			<tr>
				<td colspan="2"><h3><b>Functionality settings</b></h3></td>
			</tr>
			<tr>
				<td>Vibrate on BT connection loss</td>
				<td>
					<select id="vibrateonbt_select"  style="display: block; width: 100%;">
						<option value="on">On</option>
						<option value="off">Off</option>
					</select>
				</td>
			</tr>
			<tr>
				<td>Show the current date</td>
				<td>
					<select id="showdate_select"  style="display: block; width: 100%;">
						<option value="off">Off</option>
						<option value="on">On</option>
					</select>
				</td>
			</tr>
			<tr><td>&nbsp;</td></tr>
			<tr>
				<td colspan="2"><button id="save_button" style="display: block; width: 100%;">Save</button></td>
			</tr>
			<tr>
				<td colspan="2"><button id="cancel_button" style="display: block; width: 100%;">Cancel</button></td>
			</tr>
		</table>
	
		<script>
			function getQueryVariable(variable) 
			{
				var query = window.location.search.substring(1);
				var vars = query.split("&");
				for (var i=0;i<vars.length;i++) {
					var pair = vars[i].split("=");
					if(pair[0] == variable){return pair[1];}
				}
				
				return(false);
			}
	
			function fillOptions() {
				var vibrateOnBtSelect = document.getElementById("vibrateonbt_select");
				var showDateSelect = document.getElementById("showdate_select");
				var bgColorSelect = document.getElementById("bgcolor_select");
				var boldHourSelect = document.getElementById("boldhour_select");
				
				vibrateOnBtSelect.value = getQueryVariable("vibrateonbt_select");
				showDateSelect.value = getQueryVariable("showdate_select");
				bgColorSelect.value = getQueryVariable("bgcolor_select");
				boldHourSelect.value = getQueryVariable("boldhour_select");
			}
	
			function saveOptions() {
				var vibrateOnBtSelect = document.getElementById("vibrateonbt_select");
				var showDateSelect = document.getElementById("showdate_select");
				var bgColorSelect = document.getElementById("bgcolor_select");
				var boldHourSelect = document.getElementById("boldhour_select");
	
				var options = {
					"KEY_VIBRATEONBT": vibrateOnBtSelect.options[vibrateOnBtSelect.selectedIndex].value,
					"KEY_SHOWDATE": showDateSelect.options[showDateSelect.selectedIndex].value,
					"KEY_BGCOLOR": bgColorSelect.options[bgColorSelect.selectedIndex].value,
					"KEY_BOLDHOUR": boldHourSelect.options[boldHourSelect.selectedIndex].value
				}
	
				return options;
			}
	
			var submitButton = document.getElementById("save_button");
			submitButton.addEventListener("click",
				function() {
					console.log("Submit");
	
					var options = saveOptions();
					var location = "pebblejs://close#" + encodeURIComponent(JSON.stringify(options));
	          
					document.location = location;
				},
				false
			);
	
			var cancelButton = document.getElementById("cancel_button");
			cancelButton.addEventListener("click",
				function() {
					console.log("Cancel");
	
					var location = "pebblejs://close";
	
					document.location = location;
				},
				false
			);
		  
			fillOptions();
		</script>
	</body>
</html>
